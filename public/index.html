<!-- File: public/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GitMortem Explorer</title>

  <style>
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:#0d1117;
      color:#c9d1d9;
      padding:16px;
    }
    .container{max-width:960px;margin:0 auto;}
    h2{margin-bottom:4px;}
    p{margin-top:0;margin-bottom:12px;font-size:13px;color:#8b949e;}

    .row{display:flex;gap:8px;flex-wrap:wrap;}
    input{
      flex:1 1 240px;
      padding:8px 10px;
      border-radius:6px;
      border:1px solid #30363d;
      background:#161b22;
      color:#fff;
      font-size:14px;
      min-width:220px;
    }
    button{
      padding:8px 14px;
      border-radius:6px;
      border:none;
      cursor:pointer;
      font-size:13px;
      font-weight:600;
    }
    #load-btn{background:#238636;color:#fff;}
    #load-btn:hover{background:#2ea44f;}
    #clear-btn{background:#21262d;color:#c9d1d9;border:1px solid #30363d;}
    #clear-btn:hover{background:#30363d;}

    .card{
      background:#0d1117;
      border:1px solid #30363d;
      border-radius:10px;
      padding:10px 12px;
      margin-top:12px;
    }
    .card-header{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:13px;
      margin-bottom:6px;
    }
    .card-title{font-weight:700;}
    .card-actions{margin-left:auto;display:flex;gap:8px;align-items:center;}

    .icon-btn{
      background:#161b22;
      border:1px solid #30363d;
      border-radius:6px;
      padding:4px 8px;
      font-size:13px;
      line-height:1;
      color:#c9d1d9;
    }
    .icon-btn:hover{background:#21262d;}
    .icon-btn.merge{border-color:#ff7675;color:#ff7675;}

    #status{font-size:12px;color:#8b949e;margin-top:6px;}

    #tree{max-height:70vh;overflow:auto;}

    .folder-panel{
      margin-bottom:10px;
      padding:8px 10px;
      background:#161b22;
      border-radius:8px;
      border:1px solid #30363d;
    }
    .folder-panel-title{font-size:13px;margin-bottom:4px;font-weight:700;}
    .folder-panel pre{overflow-x:auto;white-space:pre;margin:0;}
    .file-link{color:#58a6ff;cursor:pointer;}
    .file-link:hover{text-decoration:underline;}

    #preview-box{
      min-height:120px;
      background:#161b22;
      border-radius:8px;
      border:1px solid #30363d;
      padding:8px 10px;
      font-size:12px;
      overflow:auto;
      max-height:30vh;
    }
    #preview-box pre{margin:0;white-space:pre-wrap;word-break:break-word;}

    .mini-tip{
      font-size:12px;color:#8b949e;line-height:1.4;margin-top:8px;
    }
    code{
      background:#0d1117;
      border:1px solid #30363d;
      padding:1px 6px;
      border-radius:6px;
      color:#c9d1d9;
    }

    @media (max-width: 540px){
      .row{gap:6px;}
      input{min-width:100%;}
      #load-btn,#clear-btn{width:100%;}
    }
  </style>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
</head>

<body>
  <div class="container">
    <h2>ðŸš€ GitMortem Explorer</h2>
    <p>Upper = AI-friendly tree with links â€¢ Bottom = file/folder preview. Big files? Use chunking.</p>

    <div class="row">
      <input id="repo-url" type="text" placeholder="https://github.com/owner/repo (or owner/repo)" />
      <input id="ref" type="text" placeholder="ref (optional: branch/tag/sha)" />
      <button id="load-btn">Generate Tree</button>
      <button id="clear-btn">Clear</button>
    </div>

    <div class="mini-tip">
      Tip: Chunk any file with <code>&amp;start=1&amp;end=400</code>, next chunk header <code>X-Next-Start</code>.
      Add <code>&amp;ln=1</code> for line numbers, <code>&amp;md=1</code> for code fences.
    </div>

    <div id="status">Waitingâ€¦</div>

    <!-- Tree Card -->
    <div class="card">
      <div class="card-header">
        <span class="card-title">ðŸ“‚ Repo Tree (Copy for AI)</span>
        <div class="card-actions">
          <button class="icon-btn" id="copy-tree-btn" title="Copy whole tree">ðŸ“‹</button>
          <button class="icon-btn" id="copy-ai-btn" title="Copy strict AI rules + pinned commit + tree">ðŸ§ </button>
        </div>
      </div>
      <div id="tree"></div>
    </div>

    <!-- Preview Card -->
    <div class="card">
      <div class="card-header">
        <span class="card-title">ðŸ“„ File / Folder Preview</span>
        <div class="card-actions">
          <label style="font-size:12px;color:#8b949e;display:flex;gap:6px;align-items:center;">
            <input id="toggle-ln" type="checkbox" style="accent-color:#2ea44f;" />
            Line #
          </label>
          <button class="icon-btn" id="copy-preview-btn" title="Copy preview text">ðŸ“‹</button>
          <button class="icon-btn" id="open-preview-btn" title="Open current API link in new tab">ðŸ”—</button>
          <button class="icon-btn merge" id="next-chunk-btn" title="Load next chunk / next bundle page">âž•</button>
          <button class="icon-btn merge" id="all-chunks-btn" title="Load ALL chunks/pages (may be big)">â‡ª</button>
        </div>
      </div>
      <div id="preview-box">Select a file from tree aboveâ€¦</div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
